# Ditto Keychain — 기술 개요

짧은 시간 안에 디지털 이미지를 실물 키링으로 만드는 체험형 웹앱. 참가자와 스태프의 역할을 분리하고, QR에 상태를 담아 서버 저장 없이 현장에서 재현·출력합니다.

## 핵심 특이점

- 역할 분리: 참가자(/p/*)와 스태프(/s/*)를 아예 다른 화면/흐름으로 구성
- 무서버 상태 전달: 편집 상태를 JSON→압축→base64url로 QR에 내장, 현장 스캔으로 복원
- 인쇄 정합성: 화면 가이드와 인쇄 결과가 mm 단위로 일치하도록 300 DPI 캔버스·보정(scaleX/Y) 적용
- 현장 최적화: 빠른 배치(4×5/미니CD), 프린터 확대 방지(배율 100%), 안전/동선 고려

## 프로젝트 구조(요약)

```
src/
  components/   # Sheet/Slot/Toolbar 등 UI 조각
  hooks/        # useImageEditor, useIsMobile 등
  pages/        # 참가자·스태프 페이지(편집/스캔/배치/가이드)
  utils/        # 규격 상수(printSpecs), 인코딩/제스처 등 유틸
public/         # 정적 리소스
```

주요 규격 상수(`src/utils/printSpecs.ts`)

- 시트: 100×148 mm(엽서)
- 4×5 키링: 트림 40×50 mm, 뷰포트 35×45 mm, 블리드 44×54 mm
- 미니 CD: 디스크 Ø40(블리드 Ø44, 홀 Ø5.5), 케이스 앞 40×40, 뒤 49×37
- GAP: 타일 사이 간격 4 mm, DPI: 300, mm→px 변환 유틸, 인쇄 보정 scaleX/scaleY

## 라우팅 맵(역할 분리)

참가자(Participant)

- `/` 역할 선택
- `/p/cd` 미니 CD 참가자 홈 → `/p/cd/edit` 편집
- `/p/4x5` 4×5 참가자 홈 → `/p/4x5/edit` 편집

스태프(Staff)

- `/s` 스태프 홈
- `/s/scan2` QR 스캔(2개까지)
- `/s/scan4` QR 스캔(4개까지)
- `/s/load` 코드 붙여넣기/스캔 로드
- `/s/4up` 4×5 4-up 배치/출력
- `/s/cd` 미니 CD 3-up 배치/출력
- `/s/guide` 인쇄/안전 가이드

내비게이션은 상단 `Navbar` 고정, 인쇄 시에는 UI가 숨겨지도록 구성합니다.

## 기술 스택

- 프런트엔드: React 18, TypeScript, Vite, Tailwind CSS
- 라우팅: react-router-dom v6
- QR: `qrcode`(생성), `@zxing/library`(스캔)
- 데이터 압축: `lz-string`
- 품질/도구: ESLint, TypeScript, PostCSS/Autoprefixer

## 데이터 흐름(무서버 · QR 기반)

1) 편집 상태를 직렬화(JSON)
2) LZ-String으로 압축 → base64url 인코딩
3) QR로 생성(참가자 화면)
4) 현장에서 스캔 → zxing으로 디코드 → JSON 복원(스태프 화면)
5) 4×5(앞/뒤×2) 또는 미니 CD(디스크/앞/뒤) 슬롯에 자동 매핑

데이터 스키마(예시 요약)

```json
{
  "v": 1,
  "type": "4x5",            // 또는 "cd"
  "slots": [
    { "side": "front", "img": "https://...", "fit": "contain", "scale": 1.0, "rotate": 0, "tx": [0, 0] }
  ],
  "text": [ { "value": "Hello", "font": "Pretendard", "pos": [12, 8] } ]
}
```

개인정보/저작권: 서버 저장 없이 QR에만 상태를 담아 현장에서만 사용(권장 고지 포함).

## 인쇄/출력 파이프라인

- mm→px 변환(300 DPI)으로 실제 크기 보장
- 프레임 정렬: contain+center로 편집 화면과 인쇄 일치
- 가이드: 트림(빨강)/세이프(파랑) 오버레이, CD 센터 ‘+’ 타공 마크
- 인쇄 보정: 프린터 overscan 보정을 위한 scaleX/scaleY(기본 0.95)
- 출력 권장: 100×148 mm, 무테, 배율 100%, sRGB

## 개발 방향(로드맵 제안)

- 현장 컨트롤: 인쇄 보정(scaleX/Y), 간격/외곽 여백 **UI 슬라이더** 노출
- 뒤면 정합: 4×5 뒤면 **미러/오프셋** 토글 제공
- CD 내보내기: 3-up **Export** 버튼(가이드 포함) 정식화
- 네트워크 복원력: 외부 이미지 **CORS 프록시/캐시** 폴백
- 접근성: 카메라 권한 안내, 저사양 장치 최적화
- 운영물: 안내 보드/대기표 템플릿, 테스트 프린트 카드
- 콘텐츠: 발표 이후 **영상 제작**(생성형 AI+Premiere), 샘플 이미지 보강

## 빌드/실행

- 개발: `npm run dev`
- 빌드: `npm run build`
- 미리보기: `npm run preview`

HTTPS 환경(카메라 권한)과 프린터 드라이버 사전 설치를 권장합니다.

## 리스크/한계 및 대응

- 프린터 자동확대: 반드시 **배율 100%**, 필요 시 **scaleX/Y** 보정
- 카메라 권한: HTTPS 접속, 브라우저 권한 승인 안내
- 외부 이미지: 기기 업로드 유도 또는 이미지 프록시 사용
- 대기 과밀: 대기표/타임제, 점심시간 정책(예약 담당 제외)으로 완화
