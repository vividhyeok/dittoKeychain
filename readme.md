좋아. 아래는 **React 정적 배포용 “키링 QR 인쇄 웹”**의 **완전 상세 명세(Requirement & Implementation Spec)**야. 이 문서는 다른 AI/개발자가 바로 구현을 시작할 수 있도록, 기능·데이터·라우팅·렌더링·인쇄·오류 처리까지 구체적으로 정의한다. (보안 서버/백엔드 없이 100% 프론트엔드 전제)

---

# 1. 목표(Goals)

* 참가자·스태프가 같은 웹사이트에서 각자 역할에 맞는 화면만 사용.
* **QR = 상태 재현 링크**: QR을 스캔하면 링크에 포함된(또는 링크가 가리키는) **메타데이터(JSON)**로 동일 화면/결과를 복원.
* **백엔드 없음**: 서버 저장/DB 없이 동작. 필요한 모든 정보는 **URL 파라미터(data=)** 또는 **QR 텍스트**로 전달/복원.
* **인쇄 품질 보장**: **100×148mm 용지(포스트카드/4×6inch 계열)**에 맞춰 **4×5cm 타일**을 **한 장에 2×2=4개** 배치하고 인쇄.
* 행사 운영: **스태프가 QR 2개를 스캔 → 1장(100×148mm)에 4타일(앞/뒤 × 2인분)** 배치 후 즉시 인쇄.

> 기본은 **텍스트 전용(이미지 없음)**을 채택. (필요시 이미지 URL 옵션은 스키마에 필드만 남기고 UI 비활성화)

---

# 2. 비목표(Non-Goals)

* 계정/로그인, 서버 영구 저장, 결제, 고급 보안.
* 고용량 이미지 업로드/편집(기본은 텍스트 전용).
* 네이티브 앱 설치(100% 웹).

---

# 3. 사용자 역할 & 모드

## 3.1 역할(Role)

* **Participant(참가자)**: 자신의 키링 문구를 만들고 **QR 생성**까지만.
* **Staff(스태프)**: QR **스캔/병합/배치/인쇄** 전담.

역할은 URL prefix와 로컬 저장소로 결정:

* 참가자: `/p/*`
* 스태프: `/s/*`
* `localStorage["app:role"]`에 `'participant' | 'staff'` 저장(UX 분리 목적, 보안 아님).

## 3.2 지원 모드(총 4가지)

1. **CD형 키링(3면)**: 앞면 원형(A), 뒷면 원형(B), 스파인 직사각(C) — **참가자용** 편집 + QR 생성.
2. **4×5 키링(단면)**: 40×50mm 영역 한 개 — **참가자용** 편집 + QR 생성.
3. **4-up 인쇄(양면 2인 묶음)**: **스태프용** — QR 2개 스캔(두 사람) → 1장(100×148mm)에 4타일([A앞][A뒤][B앞][B뒤]) 배치 후 인쇄. 미러/오프셋 지원.
4. **가이드/테스트**: 인쇄 정렬/색상/여백 확인용 패턴 출력.

---

# 4. 라우팅 구조(React SPA)

```
/p                참가자 홈(모드 선택)
/p/cd3            CD 3면 편집 → QR 생성
/p/4x5            4×5 편집 → QR 생성

/s                스태프 홈(퀵 링크)
/s/scan2          QR 두 개 스캔(결과를 메모리에 보관)
/s/4up            4-up 배치/미러/오프셋/인쇄
/s/guide          테스트 패턴/설명
```

* Navbar는 역할별로 별도 렌더.
* 정적 배포를 위해 SPA fallback 필요(Netlify/Vercel 설정 또는 HashRouter).

---

# 5. 인쇄 규격 & 배치

## 5.1 용지/단위

* 용지: **100mm × 148mm**(포스트카드/4×6inch 계열)
* CSS 인쇄:

  ```css
  @page { size: 100mm 148mm; margin: 0; }
  @media print { .no-print, .guides { display:none } }
  ```
* **안전영역(safe)**: **외곽 2–3mm**는 잘림 여지. 화면 가이드만 표시, 인쇄 시 숨김.
* 타일 간격: **1–2mm** 권장.

## 5.2 4×5 타일 배치(1장에 4개)

* 타일 크기: **40mm × 50mm**.
* 가로 2개(40 + 간격 1–2mm × 1 + 좌우 여백), 세로 2개(50 + 간격 1–2mm × 1 + 상하 여백) → 현실적으로 **2×2=4개** 배치 권장.
* 배치 좌표(mm, 예시 — 간격 2mm, 외곽 여백 2mm 기준):

  * 좌측 x₀=2, 우측 x₁=2 + 40 + 2 = 44
  * 상단 y₀=2, 하단 y₁=2 + 50 + 2 = 54
  * 타일 좌표: (2,2), (44,2), (2,54), (44,54)

## 5.3 CD형(3면) 실제 인쇄

* CD 앞/뒤 원형 슬롯 지름/위치, 스파인 폭/높이(mm) 값을 **상수로 정의**, 시각 가이드 표시.
* 텍스트만 배치(커브 텍스트 지원). 인쇄 시 **mm 단위** 그대로.

---

# 6. UI/UX 요구

## 6.1 참가자 화면(간결/큰 버튼)

* 단계: **문구 입력 → 폰트/색/효과 선택 → 드래그/회전(옵션) → QR 생성**.
* 폰트: 3–5종(한글 지원 WOFF2 번들).
* 색 팔레트: 8색(흰/검/회 + 브랜드 5색).
* 효과 프리셋: 외곽선(1px), 소프트 그림자, 네온.
* 제스처: 드래그/핀치/회전(모바일) — **Pointer Events** 기반.
* **QR 생성**: `?data=<압축 문자열>` 형태의 링크를 QR로 렌더.
* 큰 터치 타깃(최소 48–56px), 텍스트 최소화, 아이콘/미리보기 위주.

## 6.2 스태프 화면

* **/s/scan2**: QR 스캔 2회 → 두 페이로드를 메모리에 보관.
* **/s/4up**: 4칸 자동 배치([A앞][A뒤][B앞][B뒤]) + **스왑/미러/오프셋** 토글.
* **[인쇄]**: `window.print()` 호출. 인쇄 전 안내(“무테/여백 없음” 선택) 표시.
* **오류/복구**: 재스캔, 수동 붙여넣기, 예비 JSON 입력 폼 제공.

---

# 7. 데이터 스키마(버전 포함)

버전 필드로 호환성 관리: `"v":1`

### 7.1 공통 타입

```ts
type TextSpec = {
  text: string;        // 문구(이모지 허용)
  font: number;        // 0..4 (번들 폰트 ID)
  size: number;        // pt or px(내부 통일)
  weight?: 0|1|2;      // optional: Regular/Bold/Extra
  color: number;       // 팔레트 인덱스 0..7
  effect: 0|1|2|3;     // 0=없음,1=그림자,2=외곽선,3=네온
  tx: number; ty: number; // 위치(mm 기준, 시트 좌표계 or 슬롯 로컬좌표)
  scale: number;       // 0.2~5
  rot: number;         // 각도(도)
  curve?: boolean;     // 원형 배치 여부
  vert?: boolean;      // 세로쓰기 여부(스파인용)
};
```

### 7.2 참가자 페이로드

**4×5 단면**

```json
{
  "v":1,
  "tpl":"4x5",
  "front": { /* TextSpec */ }
}
```

**CD 3면**

```json
{
  "v":1,
  "tpl":"cd3",
  "A": { /* TextSpec (앞면 원형) */ },
  "B": { /* TextSpec (뒷면 원형) */ },
  "C": { /* TextSpec (스파인)  */ }
}
```

> (옵션) 이미지 허용 시: `front.img?: string`, `A.img?: string` … (기본 UI는 비활성화)

### 7.3 스태프 4-up 합성 입력

* 입력은 **참가자 페이로드 2개**(A, B).
* 렌더 옵션:

```json
{
  "v":1,
  "tpl":"4up",
  "A": { /* Payload 4x5 or cd3-front/back 매핑 방식 */ },
  "B": { /* same */ },
  "opts": {
    "mirrorBack": true,    // 뒷면 미러
    "xOffset": 0,          // mm 단위 미세 오프셋(양면 정렬 보정)
    "yOffset": 0
  }
}
```

---

# 8. QR 인코딩/디코딩

* 메타데이터는 **LZ-string**으로 압축 후 **base64url**로 인코딩 → `?data=` 파라미터로 링크화.
* 예: `https://site/p/4x5?data=<encoded>`
* 스태프는 `/s/scan2`에서 **QR 스캐너**로 코드 텍스트를 읽어 `data` 값을 파싱/메모리에 저장.
* 허용 입력:

  * (A) 전체 URL (자동로 `data` 추출)
  * (B) 직접 JSON(LZ 압축 전 원본)
  * (C) 압축 문자열 자체

오류 처리:

* 복원 실패 시 **명확한 경고** + 재스캔/붙여넣기 옵션.

---

# 9. 렌더링/제스처/레이아웃

## 9.1 DOM 기반 인쇄(권장)

* **Canvas 합성 없이** DOM 요소로 배치 → CORS 무관, 인쇄 일관성↑.
* 시트 컨테이너: `.sheet { width:100mm; height:148mm; position:relative }`
* 슬롯(4×5): 고정 박스 `.slot`—내부에 텍스트 요소.
* 텍스트 요소: `transform: translate/scale/rotate`, `text-shadow`/`-webkit-text-stroke` 등 CSS 효과.

## 9.2 제스처(모바일/PC 공통)

* **Pointer Events**만 사용(HTML5 Drag&Drop 금지).
* 규칙:

  * 요소에 `touch-action: none`
  * 1포인터: 드래그(tx, ty), 2포인터: 핀치(scale)/회전(rot)
  * 경계 제한: 슬롯 밖으로 크게 벗어나지 않도록 **클램프**
  * 스냅 버튼: 중앙정렬/상하/좌우 스냅 제공
* 값 양자화(선택): QR 크기 축소용 — 위치 0.5mm, 각도 2°, 크기 2% 단위 등.

## 9.3 커브 텍스트

* 원형 슬롯에 `curve=true`면, 중심/반지름 상수에 따라 각 글자 각도 배치.
* 방향(내측/외측), 시작각 옵션(필요 시).

---

# 10. 인쇄 UX

* 인쇄 버튼 누르면:

  * 안내 모달(간단): **“테두리 없음/여백 없음”**을 인쇄 대화 상자에서 선택하라고 표기.
  * `window.print()` 호출.
* `@media print`에서 UI 숨김, 가이드 숨김.
* 4-up은 **앞/뒤 인쇄 시 오프셋/미러 토글**을 빠르게 바꿔 재인쇄 가능.

---

# 11. 오류/예외 처리

* 카메라 권한 거부: 스캔 대신 **수동 입력**(URL/코드/JSON) 폴백.
* QR 디코딩 실패: 재시도 버튼, 해상도 낮은 카메라 안내(조명/거리).
* 너무 긴 데이터: 경고 + “텍스트만 사용 권장 / URL 단축 안내”.
* 인쇄 여백 문제: 가이드 페이지(`/s/guide`)에서 테스트 패턴으로 보정 후 값 저장.

---

# 12. 성능/자산

* 폰트: 3–5종 **WOFF2 번들**(subsets 권장).
* 번들 크기: 폰트 포함 1–2MB 내 목표.
* 최초 진입 속도: 코드 스플리팅(스태프/참가자 페이지 분리 로드).
* 모바일 저사양 대비: 애니메이션 최소화, 제스처 연산 스로틀(raf 기반).

---

# 13. 접근성/현장 운용

* 버튼/토글 **48–56px** 터치 타깃.
* 색약 대비(팔레트 대비 확인), 폰트 크기 확대 허용.
* 네비게이션: 참가자/스태프가 헷갈리지 않게 **시각 테마 분리**(스태프 Navbar = 다크).

---

# 14. 빌드/배포(정적)

* **Vite + React + TS**, Tailwind 선택.
* 의존: `lz-string`, `@zxing/library`, `qrcode`.
* 배포: Vercel/Netlify(권장). Netlify는 `_redirects`로 SPA fallback:

  ```
  /*  /index.html  200
  ```
* HTTPS 필수(모바일 카메라).

---

# 15. 컴포넌트 설계(요약)

* `RoleProvider`(role 관리), `ParticipantNavbar`, `StaffNavbar`
* `CanvasSheet`(mm 시트), `Slot`(사각/원형), `TextLayer`(효과/제스처)
* `QRScanner`(zxing), `QRButton`(qrcode), `PrintToolbar`(미러/오프셋/스왑)
* `encode.ts`(LZ/base64url), `gesture.ts`(Pointer Events), `layout.ts`(mm 좌표), `schema.ts`(검증)

---

# 16. 수용 기준(Acceptance Criteria)

1. 참가자 `/p/4x5`에서 문구 입력 → 폰트/색/효과 설정 → **QR 생성**이 된다.
2. 참가자 `/p/cd3`에서 3면 각각 문구/커브 설정 → **QR 생성**이 된다.
3. 스태프 `/s/scan2`에서 QR 2개를 스캔하면 내부 메모리에 **A, B**가 저장된다(재스캔/취소 가능).
4. `/s/4up`에서 **[A앞][A뒤][B앞][B뒤]**가 자동 배치되고, **스왑/미러/오프셋**이 즉시 반영된다.
5. **인쇄** 시 100×148mm 용지에 **4×5cm 타일 4개**가 올바른 간격/여백으로 인쇄된다(가이드 숨김).
6. 오프라인/느린 네트워크에서도 폰트/자산이 정상 로드되어 인쇄 가능(번들 자산).
7. 카메라 권한이 없으면 수동 입력으로도 4-up 인쇄를 완료할 수 있다.
8. 모든 기능은 **백엔드(서버 저장) 없이** 동작한다.

---

# 17. 확장(선택)

* PWA 설치(홈 화면 아이콘) — “설치 없이” 원칙과 충돌 없으면 선택.
* 캔버스 내보내기(JPEG 1800×1200) 버튼(이미지 모드 필요 시).
* 프리셋 테마(폰트/컬러/효과 일괄 적용).

---

이 명세대로 구현하면, **한 사이트**에서 **참가자/스태프 UI 분리**, **CD형/4×5/4-up/가이드** 전 과정을 **백엔드 없이** 운영할 수 있어.
원하면 이 스펙을 그대로 반영한 **React 스타터 저장소 구조+골격 코드**도 바로 만들어줄게.
